# RAGアーキテクチャ改善プラン

## 概要

レビューで特定された運用上の課題を解決するための改善プラン。

---

## 改善項目一覧

### 高優先度

- [x] **1. リトライ上限の追加（query-pipeline.md）** ✅
  - ContextGrader → QueryRewriter ループに最大リトライ回数を設定
  - AnswerGrader → QueryRewriter ループに最大リトライ回数を設定
  - HallucinationChecker → Generator ループに最大リトライ回数を設定
  - 上限到達時のフォールバック先を定義

- [x] **2. Web検索パスの修正（query-pipeline.md）** ✅
  - WebSearchNode → Generator 後のフローを明確化
  - HallucinationChecker/AnswerGraderを通るか、別経路かを決定

- [x] **3. エラーハンドリングの追加（全パイプライン）** ✅
  - 異常系フローをMermaidに追加
  - タイムアウト時の挙動を定義
  - 外部API障害時のフォールバックを定義

### 中優先度

- [x] **4. 更新パイプラインの整合性修正（update-pipeline.md）** ✅
  - Mermaidに `full_rebuild` パスを追加
  - ロールバック戦略を追記

- [x] **5. 運用監視セクションの追加（新規または各ファイル）** ✅
  - メトリクス定義（レイテンシ、エラー率、コスト）
  - アラート条件
  - ダッシュボード項目

- [x] **6. SLA/SLO定義の追加（README.md または新規）** ✅
  - 目標レイテンシ（P50, P95, P99）
  - 可用性目標
  - スループット目標

### 低優先度

- [ ] **7. スケーラビリティセクションの追加**
  - 同時リクエスト数の想定
  - 水平スケーリング戦略
  - ベクトルDBシャーディング

---

## 進捗

| # | 項目 | ステータス | 完了日 |
|---|------|----------|--------|
| 1 | リトライ上限 | 完了 | 2026-01-20 |
| 2 | Web検索パス修正 | 完了 | 2026-01-20 |
| 3 | エラーハンドリング | 完了 | 2026-01-20 |
| 4 | 更新パイプライン整合性 | 完了 | 2026-01-20 |
| 5 | 運用監視 | 完了 | 2026-01-20 |
| 6 | SLA/SLO定義 | 完了 | 2026-01-20 |
| 7 | スケーラビリティ | 未着手 | - |
